@using BPOR.Domain.Entities
@using BPOR.Rms.Startup
@using UserRole = BPOR.Domain.Enums.UserRole
@model BPOR.Rms.Models.Study.StudyDetailsViewModel
@inject ICurrentUserProvider<User> CurrentUserProvider

@{
    var isIdentifiable = Model.Study.IsRecruitingIdentifiableParticipants;
    var action = isIdentifiable ? "UpdateRecruited" : "UpdateAnonymousRecruited";
    var buttonText = isIdentifiable ? "Add enrolments" : "Update recruitment total";
    var insetText = isIdentifiable ? "Volunteer enrolments can be added when a campaign has been sent." : "The recruitment total can be updated when a campaign has been sent";
    var isAdmin = CurrentUserProvider.User.HasRole(UserRole.Admin);
    var isResearcher = CurrentUserProvider.User.HasRole(UserRole.Researcher);
}


<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-l govuk-!-margin-bottom-4">Volunteers</h2>
        <h3 class="govuk-heading-m govuk-!-margin-bottom-4 govuk-!-margin-top-0">
            Recruited (
            @if (Model.Study.IsRecruitingIdentifiableParticipants)
            {
                @Model.TotalRecruited
            }
            else
            {
                @Model.LatestRecruitmentTotal
            }
            )
        </h3>
    </div>
    <div class="govuk-grid-column-one-half right-align-buttons-desktop">
        @if (isIdentifiable ? Model.HasCampaigns : isAdmin || (Model.HasCampaigns && isResearcher))
        {
            <div class="govuk-button-group govuk-!-margin-bottom-0">
                <a asp-action="@action" 
                   asp-controller="Volunteer" 
                   asp-route-StudyId="@Model.Study.Id" 
                   role="button" 
                   draggable="false" 
                   class="govuk-button" 
                   data-module="govuk-button">@buttonText</a>
            </div>
        }
        else
        {
            <div class="govuk-inset-text govuk-!-padding-2">
                <p class="govuk-body-s govuk-!-margin-bottom-0">
                    @insetText
                </p>
            </div>
        }
    </div>
    <div class="govuk-grid-column-full"> <partial name="Partials/_RecruitedTable" for="EnrollmentDetails" /></div>
</div>
