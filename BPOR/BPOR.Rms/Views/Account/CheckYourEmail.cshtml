@model string
@using Microsoft.Extensions.Hosting
@inject IHostEnvironment hostEnvironment

@{
    ViewData["Title"] = "Check your email";
    var emailTo = ViewData["email-to"] as string;
    var emailSubject = ViewData["email-subject"] as string;
    var emailBody = ViewData["email-body"] as string;
    var emailLink = ViewData["email-link"] as string;
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h1 class="govuk-heading-l">Check your email</h1>

        <p class="govuk-body">We've sent an email to <span class="email-address">@Model</span></p>

        <p class="govuk-body">
            You'll need to click on the link in the email to confirm your email address within 24 hours.
        </p>

        <p class="govuk-body">
            Once you've confirmed your email address, you will be able to continue to create your account.
        </p>

        <div class="govuk-inset-text">
            <h2 class="govuk-heading-s">Unable to find the email?</h2>
            <p class="govuk-body">
                Check your spam folder.
            </p>

            <h2 class="govuk-heading-s">Still unable to find the email?</h2>
            <form method="post">
                <input class="govuk-input" id="email" name="email" type="hidden" spellcheck="false" aria-describedby="email-hint" autocomplete="email" value="@Model">
                <button type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button" asp-action="CheckYourEmail">
                    Resend email
                </button>
            </form>
        </div>
    </div>
</div>

@if (hostEnvironment.IsDevelopment() && !string.IsNullOrWhiteSpace(emailTo))
{
    <div class="govuk-grid-row testing-only govuk-!-margin-top-9">
        <div class="govuk-grid-column-two-thirds">
            <span class="govuk-caption-m">For testing purposes only</span>
            <h2 class="govuk-heading-m">Account verification email</h2>

            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        To
                    </dt>
                    <dd class="govuk-summary-list__value">
                        @emailTo
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Subject
                    </dt>
                    <dd class="govuk-summary-list__value">
                        @emailSubject
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Body
                    </dt>
                    <dd class="govuk-summary-list__value">
                        <iframe style="width:100%; height:25vh;" src="@($"data:text/html;base64,{Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(emailBody))}")"></iframe>
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Link
                    </dt>
                    <dd class="govuk-summary-list__value">
                        <a href="@Html.Raw(emailLink)">@emailLink</a>
                    </dd>
                </div>
            </dl>
        </div>
    </div>
}